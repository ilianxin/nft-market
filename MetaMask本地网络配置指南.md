# 🦊 MetaMask本地网络配置完整指南

## 🎯 问题诊断

✅ **本地Hardhat网络状态**：正常运行
- 端口8545正在监听
- RPC节点响应正常
- 当前区块号：10

❌ **问题**：MetaMask无法连接到本地网络

## 🛠️ 解决方案：正确配置MetaMask本地网络

### 步骤1：添加本地网络到MetaMask

1. **打开MetaMask扩展**
2. **点击网络下拉菜单**（通常显示"Ethereum Mainnet"）
3. **点击"添加网络"**
4. **选择"手动添加网络"**

### 步骤2：填入正确的网络配置

请**完全按照以下参数**填写：

```
网络名称: Hardhat Local
新的RPC URL: http://localhost:8545
链ID: 31337
货币符号: ETH
区块浏览器URL: (留空)
```

⚠️ **重要提示**：
- 链ID **必须**是 `31337`（这是Hardhat的默认链ID）
- RPC URL **必须**是 `http://localhost:8545`
- 不要使用 `127.0.0.1:8545`，使用 `localhost:8545`

### 步骤3：保存并切换网络

1. **点击"保存"**
2. **确认网络已添加**
3. **切换到"Hardhat Local"网络**

### 步骤4：导入测试账户

1. **点击右上角的账户图标**
2. **选择"导入账户"**
3. **选择"私钥"**
4. **输入测试私钥**：
   ```
   ac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80
   ```
5. **点击"导入"**

导入后的账户信息：
```
地址: 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
余额: ~9999 ETH (测试ETH)
```

## 🔍 常见问题及解决方案

### 问题1：链ID冲突
**错误信息**：`Chain ID mismatch`

**解决方案**：
1. 删除现有的本地网络配置
2. 重新添加，确保链ID为 `31337`

### 问题2：RPC连接超时
**错误信息**：`RPC Error: Request timeout`

**解决方案**：
1. 确认Hardhat网络正在运行
2. 检查防火墙设置
3. 尝试重启Hardhat网络

### 问题3：无法连接到localhost
**错误信息**：`Failed to fetch`

**解决方案**：
1. 确保使用 `http://localhost:8545` 而不是 `https://`
2. 检查浏览器是否阻止了本地连接
3. 尝试使用 `http://127.0.0.1:8545`

### 问题4：账户余额显示为0
**可能原因**：
- 使用了错误的私钥
- 连接到了错误的网络

**解决方案**：
1. 确认私钥正确
2. 确认连接到Hardhat Local网络
3. 重新导入账户

## 🧪 验证网络连接

### 方法1：检查账户余额
连接成功后，测试账户应该显示约9999 ETH的余额。

### 方法2：发送测试交易
可以尝试发送一个小额测试交易来验证网络连接。

### 方法3：使用开发者工具
1. 按F12打开浏览器开发者工具
2. 查看Console标签页
3. 查看是否有网络错误信息

## 🔄 重新启动网络（如果需要）

如果仍然有问题，可以重新启动本地网络：

### 停止当前网络
找到运行Hardhat的终端窗口，按 `Ctrl+C` 停止。

### 重新启动网络
```bash
cd contracts
npx hardhat node
```

### 重新部署合约
在新的终端窗口中：
```bash
cd contracts
npx hardhat run scripts/deploy.js --network localhost
```

## 📱 MetaMask移动端配置

如果使用MetaMask移动应用：

1. **打开MetaMask应用**
2. **点击左上角的菜单**
3. **选择"设置" > "网络"**
4. **点击"添加网络"**
5. **填入相同的网络配置**

⚠️ **注意**：移动端可能需要使用你的电脑IP地址而不是localhost。

## ✅ 成功连接的标志

当MetaMask成功连接到本地网络时，你应该看到：

1. **网络名称显示为"Hardhat Local"**
2. **测试账户余额约9999 ETH**
3. **可以正常发送交易**
4. **前端应用可以连接到钱包**

## 🆘 如果仍然无法连接

请提供以下信息以便进一步诊断：

1. **MetaMask的具体错误信息**
2. **浏览器控制台的错误日志**
3. **网络配置的截图**
4. **使用的浏览器和版本**

## 📞 快速检查清单

- [ ] Hardhat网络正在运行（端口8545）
- [ ] MetaMask网络配置正确（链ID: 31337）
- [ ] RPC URL使用http://localhost:8545
- [ ] 已导入正确的测试私钥
- [ ] 浏览器允许访问localhost
- [ ] 没有其他应用占用8545端口

按照以上步骤操作后，MetaMask应该能够成功连接到本地NFT网络！
